<!DOCTYPE html>
<html lang="ja">
<head>
  <title>ポケモンクイズ</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2.0.6/css/pico.min.css">
  <style>
    html, body {
  height: 100%;      /* 高さを画面いっぱいに */
  margin: 0;         /* デフォルト余白を消す */
}
body {
  display: flex;              /* Flexbox にする */
  justify-content: center;    /* 横方向中央 */
  align-items: center;        /* 縦方向中央 */
  background: linear-gradient(135deg, #ffefd5, #ffe4e1);
  font-family: "Comic Sans MS", "Arial Rounded MT Bold", sans-serif;
  text-align: center;         /* 残してもOK */
}
    h1 {
      font-size: 2.5em;
      color: #ff4500;
      text-shadow: 2px 2px 0px #fff;
      animation: fadeInDown 1s ease-out;
    }
    #pokemon {
  width: 320px;
  background: #fff8dc;
  border-radius: 20px;
  padding: 20px;
  box-shadow: 4px 4px 12px rgba(0,0,0,0.2);
  animation: popIn 0.8s ease-out;
}

    #pokemonName {
      font-size: 2em;
      color: #ff7f50;
    }
    #pokemonEnglishName {
      font-size: 1.2em;
      color: #555;
    }
    #pokemonImage {
      width: 80%;
      margin: 10px auto;
      display: block;
      background: #f0f8ff;
      border-radius: 15px;
      padding: 10px;
      opacity: 0;                    /* ★ 初期は透明 */
      transition: opacity 600ms ease-in; /* ★ フェードイン用 */
    }
    button {
      font-size: 1.2em;
      padding: 10px 20px;
      border-radius: 15px;
      background: #ff69b4;
      border: none;
      color: white;
      cursor: pointer;
      margin-top: 15px;
      transition: transform 0.2s ease;
    }
    button:hover { background: #ff1493; transform: scale(1.05); }

    /* ★ 答え表示・カード登場・ボタン弾み・名前ポップ用 */
    #answer { margin-top: 10px; font-weight: bold; color: #ff4500; display: none; }
    .reveal { display: block !important; animation: popIn 0.6s ease-out; } /* 答え用 */
    .fade-in { opacity: 1 !important; }        /* 画像フェードイン */
    .pop { animation: popIn 0.45s ease-out; }  /* 見出しのポップ */
    .bounce { animation: bounce 0.35s ease-out; } /* ボタンの弾み */

    /* ★ キーフレーム */
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-30px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes popIn {
      0%   { transform: scale(0.7); opacity: 0; }
      100% { transform: scale(1);   opacity: 1; }
    }
    @keyframes bounce {
      0%   { transform: scale(1); }
      30%  { transform: scale(0.95); }
      60%  { transform: scale(1.06); }
      100% { transform: scale(1); }
    }

    /* ★ 動きを苦手とする環境への配慮（任意） */
    @media (prefers-reduced-motion: reduce) {
      * { animation: none !important; transition: none !important; }
      #pokemonImage { opacity: 1; }
    }
  </style>
</head>
<body>

<main class="container">
  
  <h1>🦊 ポケモンクイズ 🦊</h1>
  
  <div id="pokemon">
    <h2 id="pokemonName">？？？</h2>
    <p id="pokemonEnglishName"></p>
    <img id="pokemonImage" src="">
    <button id="newPokemon">ほかのポケモン！</button>

    <div id="quiz">
      もんだい！
      <br> このポケモンの名前はなんでしょう？
      <br>
      <button id="showAnswer">こたえをみる</button>
      <p id="answer"></p>
    </div>
  </div>
</main>

<script>
  const pokemonName = document.getElementById('pokemonName');
  const pokemonNameEnglish = document.getElementById('pokemonEnglishName');
  const pokemonImage = document.getElementById('pokemonImage');
  const answer = document.getElementById('answer');
  const btnNew = document.getElementById('newPokemon');       // ★
  const btnAnswer = document.getElementById('showAnswer');    // ★

  async function loadPokemon() {
    try {
      let pokemonNumber = Math.floor(Math.random() * 25) + 1;

      // 基本データ
      const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonNumber}`);
      const data = await res.json();

      // ★ 画像はプリロードしてから差し替え → 毎回フェードイン
      const url = data.sprites.front_default || "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/0.png";
      pokemonImage.classList.remove('fade-in');       // リセット
      const pre = new Image();
      pre.onload = () => {
        pokemonImage.src = url;
        // レイアウト確定後にフェードイン（再生を確実にするテクニック）
        requestAnimationFrame(() => pokemonImage.classList.add('fade-in'));
      };
      pre.src = url;

      // 名前データ
      const res2 = await fetch(`https://pokeapi.co/api/v2/pokemon-species/${pokemonNumber}`);
      const speciesData = await res2.json();

      let japaneseName = speciesData.names.find(n => n.language.name === "ja-Hrkt")
                       || speciesData.names.find(n => n.language.name === "ja");
      let englishName = speciesData.names.find(n => n.language.name === "en");

      if (japaneseName) {
      pokemonName.textContent = "？？？"; // 最初は隠す
      pokemonName.dataset.answer = japaneseName.name;
     } else {
      pokemonName.textContent = "(日本語名なし)";
      pokemonName.dataset.answer = "";
    }


      pokemonNameEnglish.textContent = englishName ? `English: ${englishName.name}` : "(英語名なし)";

      // ★ 答えは非表示＆アニメーションの状態リセット
      answer.classList.remove("reveal");
      pokemonName.classList.remove("pop");
      // 強制再計算で次回アニメを確実に再生
      void pokemonName.offsetWidth;
    } catch (error) {
      console.error("エラー:", error);
      pokemonName.textContent = "ポケモンが見つかりませんでした";
    }
  }

  // 初回ロード
  loadPokemon();

  // ★ ボタンの弾むアニメ
  function bounceOnce(e) {
    const btn = e.currentTarget;
    btn.classList.remove('bounce');
    void btn.offsetWidth;    // アニメ再始動の小技
    btn.classList.add('bounce');
  }
  btnNew.addEventListener("click", (e) => { bounceOnce(e); loadPokemon(); });
  btnAnswer.addEventListener("click", (e) => {
  bounceOnce(e);
  // 答え表示（名前見出しをポップ表示）
  pokemonName.textContent = pokemonName.dataset.answer || "？？？";
  pokemonName.classList.remove("pop");
  void pokemonName.offsetWidth; // 再始動
  pokemonName.classList.add("pop");
});
</script>

</body>
</html>
